sources:
- name: limine
  subdir: "ports"
  git: "https://github.com/limine-bootloader/limine.git"
  tag: "v10.6.5"
  version: "10.6.5"
  tools_required:
  - host-autoconf
  - host-automake
  - host-libtool
  regenerate:
  - args: [ "@SOURCE_ROOT@/support/autoreconf.sh", "-I@THIS_SOURCE_DIR@/config" ]
  - args: [ "./bootstrap" ]
    isolate_network: false

packages:
- name: limine
  architecture: "@OPTION:arch@"
  from_source: limine
  tools_required:
  - host-binutils
  - host-llvm
  configure:
  - args:
    - "@THIS_SOURCE_DIR@/configure"
    - "--prefix=/usr"
    - "--host=@OPTION:arch@-@OPTION:triple@"
    - "--enable-all"
  build:
  - args: [ "make", "-j@PARALLELISM@" ]
  - args: [ "make", "install" ]
    environ:
      DESTDIR: "@THIS_COLLECT_DIR@"
  # Copy the configuration
  - args: [ "mkdir", "-p", "@THIS_COLLECT_DIR@/boot/" ]
  - args: [ "cp", "@SOURCE_ROOT@/support/limine/limine.conf", "@THIS_COLLECT_DIR@/boot/limine.conf" ]
  # Copy the EFI binaries
  - args: [ "mkdir", "-p", "@THIS_COLLECT_DIR@/boot/EFI/BOOT/" ]
  - args: [ "cp", "-r", "@THIS_COLLECT_DIR@/usr/share/limine/.", "@THIS_COLLECT_DIR@/boot/EFI/BOOT/" ]

- name: zinnia
  architecture: "@OPTION:arch@"
  source:
    name: src
  revision: 1
  tools_required:
  - host-meson
  - host-gcc
  pkgs_required:
  - mlibc
  configure:
  - args:
    - "meson"
    - "setup"
    - "--cross-file"
    - "@BUILD_ROOT@/tools/host-meson/cross.txt"
    - "--bindir=/usr/bin"
    - "--libdir=/usr/lib"
    - "--libexecdir=/usr/lib"
    - "--sbindir=/usr/sbin"
    - "@THIS_SOURCE_DIR@"
  build:
  - args: [ "ninja" ]
  - args: [ "ninja", "install" ]
    environ:
      DESTDIR: "@THIS_COLLECT_DIR@"

- name: openrc
  labels: [ broken ]
  architecture: "@OPTION:arch@"
  source:
    subdir: "ports"
    git: "https://github.com/OpenRC/openrc.git"
    tag: "0.56"
    version: "0.56"
  revision: 1
  tools_required:
  - host-llvm
  - host-meson
  pkgs_required:
  - mlibc
  configure:
  - args:
    - "meson"
    - "setup"
    - "--cross-file"
    - "@BUILD_ROOT@/tools/host-meson/cross.txt"
    - "--bindir=/usr/bin"
    - "--libdir=/usr/lib"
    - "--libexecdir=/usr/lib"
    - "--sbindir=/usr/sbin"
    - "-Daudit=disabled"
    - "-Dbash-completions=true"
    - '-Dbranding="Zinnia"'
    - "-Dlocal_prefix=usr/local"
    - "-Dnewnet=false"
    - "-Dos=Zinnia"
    - "-Dpam=false"
    - "-Dpkg_prefix=usr"
    - "-Dselinux=disabled"
    - '-Dshell="/bin/sh"'
    - "-Dsysvinit=false"
    - "-Dzsh-completions=false"
    - "@THIS_SOURCE_DIR@"
  build:
  - args: [ "ninja" ]
  - args: [ "ninja", "install" ]
    environ:
      DESTDIR: "@THIS_COLLECT_DIR@"
